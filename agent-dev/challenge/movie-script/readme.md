# 外部ナレッジを使って映画企画書を書くAgent


## ワークフローエージェント (Workflow Agents)
親エージェントからサブエージェントへの制御の移行は、専門分野を持つ複数のサブエージェントが存在し、ユーザーがそれら各々と個別に対話するような場合に適しています。

しかし、ユーザーの応答を待たずにエージェントが次々と動作するようにしたい場合は、ワークフローエージェントを使用できます。ワークフローエージェントを使用するシナリオの例としては、エージェントに次のようなことをさせたい場合が挙げられます。

計画と実行: あるエージェントにアイテムのリストを準備させ、そのリストを他のエージェントが使って、例えばドキュメントのセクションを執筆するなどのフォローアップタスクを実行させたい場合。

調査と執筆: あるエージェントにGoogle検索や他のデータソースからコンテキスト情報を収集するための関数を呼び出させ、その情報を別のエージェントが使って何らかの出力を生成させたい場合。

下書きと修正: あるエージェントにドキュメントの下書きを準備させ、他のエージェントがその作業をチェックして繰り返し修正させたい場合。

このようなタスクを達成するために、ワークフローエージェントはサブエージェントを持ち、それぞれのサブエージェントが確実に動作することを保証します。Agent Development Kitは、3つの組み込みワークフローエージェントと、独自のものを定義する機能を提供します。

- SequentialAgent

- LoopAgent

- ParallelAgent

このサンプルでは、複数のLLMエージェント、ワークフローエージェント、およびツールを使用してエージェントのフローを制御するマルチエージェントシステムを構築しています。

具体的には、歴史上の人物の生涯に基づいた伝記映画という、新しいヒット映画の企画書を作成するエージェントを構築します。サブエージェントが調査、脚本家と批評家による反復的な執筆ループを担当し、最後にいくつかの追加のサブエージェントがキャスティングのアイデアをブレインストーミングし、過去の興行収入データを使って興行成績を予測します。

最終的に、マルチエージェントシステムはこのようになります.。


![architecture](https://github.com/GoogleCloudPlatform/gcp-getting-started-lab-jp/blob/master/agent-dev/samples/movie-script/arch.png)


## Agentの使い方

## Python仮想環境

```shell
python3 -m venv virtual-environment
source virtual-environment/bin/activate
```

## 依存ファイルインストール

```shell
pip install -r requirements.txt 
```

## Dev UI昨日

```shell
adk web
```

http://localhost:8000 にアクセスして、movie-script agent を選んで操作してみてください。

## やり取りの例

```

user >> こんにちは！

agent >> こんにちは！大ヒット間違いなしの映画の企画書作りをお手伝いします。
どの歴史上の人物を題材にした映画を作りたいですか？

user >> 織田信長

＜そのあとresearcherは情報収集します＞
Agent >> 織田信長について調べました。

織田信長（1534年 - 1582年）は、戦国時代から安土桃山時代にかけての日本の大名で、日本の「天下人」と称され、最初の「天下統一」を成し遂げた人物とされています。時に「第六天魔王」とも呼ばれました。

彼は、豊臣秀吉、徳川家康とともに「三英傑」と称される日本の歴史上の重要な人物です。信長は1560年代から他の大名との戦いを重ね、強力な織田氏の当主として権力を固め、秀吉と家康によるその後の統一事業の基礎を築きました。信長と秀吉が権力を握っていた時代は安土桃山時代と呼ばれ、信長の安土城と秀吉の伏見城に由来します。

信長は1573年に名目上の将軍であった足利義昭を追放し、室町幕府を滅ぼして最も強力な大名となりました。1580年までに本州の大部分を征服し、一向一揆も鎮圧しました。信長の統治は、革新的な軍事戦術、自由貿易の奨励、民政改革、桃山美術の始まりで知られる一方で、協力しない者や要求に従わない者への残忍な弾圧でも知られています。

信長は1582年の本能寺の変で、家臣の明智光秀に京都の寺で襲撃され、自害しました。信長の死後、豊臣秀吉が後を継ぎ、徳川家康とともに日本の統一事業を完成させました。

戦国時代は、15世紀から16世紀にかけて日本で内乱と社会変動がほぼ絶え間なく続いた時代です。この時代は、下位の者が上位の権力を打倒することが特徴で、室町幕府の権威が衰退し、戦国大名と呼ばれる地方勢力が台頭しました。また、一向一揆のような民衆による反乱も起こりました。

この時代には、主君と家臣の伝統的な関係が崩壊し、家臣が主君に反逆したり、貴族の家系内で家督を巡る争いが起こったり、名ばかりの主君が擁立されたりしました。また、武士の文化も緩み、他の身分出身の者が武士として名を上げ、戦国大名にまで上り詰めることもありました。その最も顕著な例が、農民出身から武士、戦国大名、そして関白にまで上り詰めた豊臣秀吉です。


<そのあとscreen_writer agentは企画書を書きます>

はい、承知いたしました。織田信長のログラインと三幕構成のあらすじを作成しました。

ログライン 戦乱の世に終止符を打ち、天下統一を夢見た風雲児・織田信長。革新と冷酷さで時代を切り開いた彼の壮絶な生涯は、いかにして日本の未来を築き上げたのか？

三幕構成のあらすじ

第一幕：乱世の風雲児

導入: 16世紀半ば、群雄割拠の戦国時代。尾張の小大名・織田信長は、周囲からは「うつけ者」と揶揄されながらも、既存の価値観に囚われない自由な発想と、天下統一という壮大な野望を胸に秘めている。
葛藤: 伝統的な戦術に固執する家臣たちの反発、今川義元のような強大な敵との対峙。信長は、桶狭間の戦いでの奇襲など、常識を覆す戦術で勝利を収め、その名を轟かせ始める。
転換点: 美濃攻略、足利義昭を奉じての上洛。信長は、旧態依然とした室町幕府の権威を目の当たりにし、真の天下統一には自らの手で新たな秩序を築くしかないと確信する。
第二幕：覇道の光と影

発展: 信長は、楽市楽座の導入、鉄砲隊の活用、比叡山焼き討ちなど、革新的な政策と時に冷酷な手段で勢力を拡大していく。彼の支配は、旧勢力との激しい摩擦を生むが、同時に新しい時代の幕開けを予感させる。
高揚: 武田信玄、上杉謙信といった強敵との戦いを経て、信長は本州の大部分を制圧。安土城を築き、その権力と文化の象徴とする。天下統一は目前に迫り、家臣たちもその夢の実現を信じ始める。
危機: 権力の増大とともに、信長の独裁的な側面が強まり、家臣との間に亀裂が生じ始める。特に、明智光秀との関係に不穏な影が差し始める。一向一揆の徹底的な鎮圧など、その苛烈な統治は、多くの恨みを買う。
第三幕：夢の残照

対立: 天下統一を目前にした信長は、四国攻めを命じるなど、さらなる拡大を目指す。しかし、その強引なやり方は、家臣たちの不満を募らせる。特に、光秀の心には、信長への不信感と恐怖が募っていく。
クライマックス: 1582年、本能寺。信長は、まさかの家臣・明智光秀の裏切りに遭い、炎に包まれた寺の中で自害を決意する。彼の天下統一の夢は、志半ばで潰える。
結末: 信長の死後、豊臣秀吉が「中国大返し」で光秀を討ち、信長の遺志を継いで天下統一を成し遂げる。信長の革新的な思想と、彼が築いた基盤が、その後の日本の平和と発展に繋がったことが示唆される。彼の夢は、形を変えて受け継がれたのだ。
今回のパスでは、提供されたプロットアウトラインをそのまま採用し、日本語で応答することに注力しました。

<そのあとcritic agentは企画書を書きます>

提示されたプロットアウトラインについて、以下の点を評価しました。

三幕構成の満足度: 非常に満足のいく三幕構成が構築されています。各幕の始まり、中間、終わりが明確で、物語の進行が論理的かつドラマチックです。信長の成長と葛藤、権力の拡大と影、そして悲劇的な終焉から遺志の継承へと、映画的な流れが感じられます。
登場人物の葛藤の魅力: 織田信長自身の「うつけ者」からの脱却、革新性と冷酷さの共存、家臣との摩擦、特に明智光秀との関係性など、彼の内面と外面の葛藤がよく描かれており、非常に魅力的です。信長という人物の多面性が表現されています。
史実との整合性: 16世紀半ばの戦国時代という時代背景が明確であり、桶狭間の戦い、足利義昭の上洛、楽市楽座、比叡山焼き討ち、安土城築城、本能寺の変、中国大返しなど、重要な史実が盛り込まれており、歴史的時代にしっかりと根ざしています。
リサーチ情報の活用度: 提供されたリサーチ情報（織田信長の人物像、革新性と冷酷さ、三英傑、本能寺の変、戦国時代の下剋上など）がプロットアウトラインに効果的に組み込まれています。信長が築いた基盤がその後の統一に繋がったという結末も、リサーチ内容を適切に反映しています。
全体として、提供されたプロットアウトラインは、すべての評価基準を高いレベルで満たしており、大幅な改善の必要はないと判断しました。このまま次のステップに進んで問題ないでしょう。

したがって、append_to_stateツールを使用する必要はありません。

提示されたプロットアウトラインは、非常に高いレベルで評価されました。三幕構成、登場人物の葛藤、史実との整合性、リサーチ情報の活用度、すべてにおいて満足のいく内容です。このまま次のステップに進んで問題ありません。

<critic agentが高く評価したのでそのあと続ける結果に>

承知いたしました。プロットアウトラインが高く評価されたこと、大変嬉しく思います。このまま次のステップに進んで問題ありません。


Agent >> 「信長：天下の炎」の企画書ファイルをmovie_pitchesディレクトリに作成しました。
```

最後プロジェクトのフォルダで movie_pitches フォルダが作成され、映画企画書が作成されているのが確認できます。